<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="stylesheet.css" />
    <title>Statsig Feature Test</title>
    <!-- Directly include the Statsig SDK script -->
    <script src="https://cdn.jsdelivr.net/npm/statsig-js/build/statsig-prod-web-sdk.min.js"></script>
  </head>
  <body>
    <h1>Welche Produktversion kann ich verwenden?</h1>
    <p>
      Wir prüfen deinen Browsertyp, in welchem Land du gerade bist, und wann du
      das Produkt anfragst, um dir die richtige Produktversion zu geben!
    </p>

    <!-- Button für Browser Check -->
    <button id="checkBrowserButton">Check my Browser</button>
    <div id="browserResult" class="check-result">Result: Not Checked</div>

    <!-- Button für Ländercode Check -->
    <button id="checkCountryButton">Check my Country</button>
    <div id="countryResult" class="check-result">Result: Not Checked</div>

    <!-- Button für Early Bird Check -->
    <button id="checkEarlyBirdButton">Check am I a Early Bird?</button>
    <div id="earlyBirdResult" class="check-result">Result: Not Checked</div>

    <script>
      // Function to get the Statsig API Key
      function getStatsigAPIKey() {
        return 'client-iP1C5UeGqpTQsrLm851hJDdmBXr70bNayiqkKTzla75'; // Replace with your actual API key
      }

      // Initialize Statsig once the window is loaded
      window.onload = function () {
        const user = {
          userID: '3cK58mzYUTp2TAvfBvZWqu',
          custom: {
            browser_name: navigator.userAgent,
            country: 'DE',
          },
        };

        statsig
          .initialize(getStatsigAPIKey(), user) // Provide user object directly
          .then(() => {
            console.log('Statsig SDK initialized');
            // Log an event to Statsig with user data
            statsig.logEvent('user_initialized', user);

            // Event-Listener für den Browser-Button
            document
              .getElementById('checkBrowserButton')
              .addEventListener('click', async function () {
                try {
                  const browserGate = await statsig.checkGate(
                    'browser_name_chrome'
                  );
                  console.log('Browser Gate Result:', browserGate);
                  document.getElementById('browserResult').innerText =
                    browserGate
                      ? 'Herzlichen Glückwunsch! Du bist ein deutscher Benutzer, du kannst zuerst unsere Testversion ausprobieren!'
                      : 'Wie der Rest der Benutzer nutzt auch du unser offizielles Produkt.';
                } catch (gateError) {
                  console.error(
                    'Feature-Gate-Check für Browser fehlgeschlagen:',
                    gateError
                  );
                }
              });

            // Event-Listener für den Ländercode-Button
            document
              .getElementById('checkCountryButton')
              .addEventListener('click', async function () {
                try {
                  const countryGate = await statsig.checkGate('country_de');
                  console.log('Country Gate Result:', countryGate);
                  document.getElementById('countryResult').innerText =
                    countryGate
                      ? 'Herzlichen Glückwunsch! Du bist ein deutscher Benutzer, du kannst zuerst unsere Testversion ausprobieren!'
                      : 'Wie der Rest der Benutzer nutzt auch du unser offizielles Produkt.';
                } catch (gateError) {
                  console.error(
                    'Feature-Gate-Check für Land fehlgeschlagen:',
                    gateError
                  );
                }
              });

            // Event-Listener für den Early Bird-Button
            document
              .getElementById('checkEarlyBirdButton')
              .addEventListener('click', async function () {
                try {
                  const earlyBirdGate = await statsig.checkGate(
                    'before_august_4'
                  );
                  console.log('Early Bird Gate Result:', earlyBirdGate);
                  document.getElementById('earlyBirdResult').innerText =
                    earlyBirdGate
                      ? 'Herzlichen Glückwunsch! Du bist ein Early Bird, kannst zuerst unsere Testversion ausprobieren!'
                      : 'Wie der Rest der Benutzer nutzt auch du unser offizielles Produkt.';
                } catch (gateError) {
                  console.error(
                    'Feature-Gate-Check für Early Bird fehlgeschlagen:',
                    gateError
                  );
                }
              });
          })
          .catch((error) => {
            console.error('Statsig-Initialisierung fehlgeschlagen:', error);
          });
      };
    </script>
  </body>
</html>
